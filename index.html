<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#16a34a"/>
  <title>فاتورة بسام</title>

  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./icon-192.png">
  <link rel="apple-touch-icon" href="./icon-192.png">
  <link rel="stylesheet" href="./styles.css"/>

  <!-- PDF مباشر -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script defer src="./app.js"></script>
</head>
<body>

  <div class="container">

    <header class="brand-header">
      <div class="brand-title">
        <h1>مكتب بسام الشتيمي للتخليص الجمركي</h1>
        <div class="brand-sub">
          <span>جوال: <b>00967771997809</b></span>
          <span class="dot">•</span>
          <span>البريد: <b>Bassam.7111111@gmail.com</b></span>
        </div>
      </div>
      <div class="brand-badge">BassamInvoice</div>
    </header>

    <main id="appRoot">

      <section class="card">
        <h2 class="card-title">فاتورة بسام</h2>

        <div class="grid-2">
          <div class="field">
            <label>اسم العميل:</label>
            <input id="customerName" type="text" placeholder="مثال: محمد علي" />
          </div>

          <div class="field">
            <label>رقم الفاتورة:</label>
            <input id="invoiceNo" type="text" placeholder="مثال: 1025" />
          </div>

          <div class="field">
            <label>العملة:</label>
            <select id="currency">
              <option value="ريال سعودي">ريال سعودي</option>
              <option value="دولار">دولار</option>
              <option value="درهم إماراتي">درهم إماراتي</option>
              <option value="ريال يمني">ريال يمني</option>
            </select>
          </div>

          <div class="field">
            <label>التاريخ:</label>
            <input id="invoiceDate" type="date"/>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="items-head">
          <h3 class="card-title">الأصناف</h3>
          <button class="btn btn-outline" id="addRowBtn" type="button">+ إضافة صنف</button>
        </div>

        <div class="table-wrap">
          <table class="items">
            <thead>
              <tr>
                <th style="width:56px">#</th>
                <th>الصنف</th>
                <th style="width:110px">العدد</th>
                <th style="width:140px">وزن/كرتون</th>
                <th style="width:140px">قيمة/كرتون</th>
                <th style="width:140px">الوزن الكلي</th>
                <th style="width:140px">القيمة الكلية</th>
                <th style="width:70px"></th>
              </tr>
            </thead>
            <tbody id="itemsBody"></tbody>
          </table>
        </div>

        <div class="totals">
          <div class="tot-box">
            <div class="tot-label">إجمالي العدد:</div>
            <div class="tot-val" id="sumQty">0</div>
          </div>
          <div class="tot-box">
            <div class="tot-label">إجمالي الوزن (كجم):</div>
            <div class="tot-val" id="sumWeight">0.00</div>
          </div>
          <div class="tot-box">
            <div class="tot-label">إجمالي القيمة:</div>
            <div class="tot-val" id="sumValue">0.00</div>
          </div>
        </div>
      </section>

      <section class="card">
        <h3 class="card-title">تسجيل صوت (ملاحظة/اتفاق)</h3>

        <div class="voice-wrap">
          <button class="btn btn-outline" id="recStartBtn" type="button">بدء التسجيل</button>
          <button class="btn btn-outline" id="recStopBtn" type="button" disabled>إيقاف</button>
          <a class="btn btn-ghost" id="recDownloadLink" href="#" download="voice-note.webm" style="display:none">تنزيل الصوت</a>
        </div>

        <audio id="recAudio" controls style="width:100%; margin-top:10px; display:none"></audio>
        <p class="note">التسجيل يعمل داخل المتصفح ويطلب إذن المايكروفون. لا يوجد تحويل للنص في هذه النسخة.</p>
      </section>

      <section class="card">
        <h3 class="card-title">معاينة الفاتورة</h3>

        <div id="invoicePreview" class="invoice-preview"></div>

        <div class="actions">
          <button class="btn btn-ghost" id="closeBtn" type="button">إغلاق</button>

          <button class="btn btn-outline" id="downloadPdfBtn" type="button">
            تنزيل PDF مباشر
          </button>

          <button class="btn btn-primary" id="printBtn" type="button">
            طباعة / حفظ PDF
          </button>
        </div>

        <p class="note">
          داخل التطبيق المثبّت (PWA) زر الطباعة سيفتح تبويب Chrome للطباعة تلقائيًا (حل نهائي لمشكلة عدم ظهور نافذة الطباعة).
        </p>
      </section>

    </main>

    <footer class="footer">
      <span>© Bassam Invoice App</span>
    </footer>

  </div>
</body>
</html>
